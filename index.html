<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TripA-B Tracker</title>

  <!-- ‚úÖ PWA Manifest -->
  <link rel="manifest" href="./manifest.json" />

  <!-- ‚úÖ Icons -->
  <link rel="icon" href="./icon-192.png" type="image/png" />
  <link rel="apple-touch-icon" href="./icon-512.png" />

  <!-- ‚úÖ Meta -->
  <meta name="theme-color" content="#0d6efd" />
  <meta name="description" content="TripA-B Tracking Progressive Web App" />
</head>

<body>
  <noscript>‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô JavaScript ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πá‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</noscript>

  <!-- Loader -->
  <div id="loading" style="text-align:center; margin-top:40vh;">
    <h3>üöó ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î TripA-B...</h3>
  </div>

  <script>
    // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î Service Worker ‡∏ó‡∏±‡πâ‡∏á‡πÉ‡∏ô Browser ‡πÅ‡∏•‡∏∞ Web App
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js')
        .then(reg => {
          console.log('[SW] Registered:', reg.scope);

          // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ SW ‡πÉ‡∏´‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö
          reg.onupdatefound = () => {
            const newWorker = reg.installing;
            console.log('[SW] ‡∏û‡∏ö Service Worker ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà...');
            newWorker.onstatechange = () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                console.log('[SW] üîÑ New version ready, activating...');
                newWorker.postMessage('SKIP_WAITING');
              }
            };
          };
        })
        .catch(err => console.error('[SW] Registration failed:', err));

      // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ SW ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° ‚Üí reload ‡∏´‡∏ô‡πâ‡∏≤ (‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
      let refreshing = false;
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (refreshing) return;
        refreshing = true;
        console.log('[SW] Controller changed ‚Üí reloading...');
        window.location.reload();
      });
    }

    // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î TripA-B.html (‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ)
    window.addEventListener('load', () => {
      setTimeout(() => {
        window.location.href = './TripA-B.html';
      }, 800);
    });
  </script>
</body>
</html>
